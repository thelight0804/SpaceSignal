# 2026-01-17-FastAPI health check 구현 및 CORS 설정

## Summary (회의 요약)
FastAPI에 health check 엔드포인트를 구현하고, CORS 미들웨어를 설정하여 프론트엔드와의 통신을 연결함. 프론트엔드에서 비동기 데이터 처리를 위한 조건부 렌더링 패턴을 학습하고 적용함.

## Commits (커밋 내역)
1. `feat: Implement health check endpoint #2` (11:38)
   - `/hello` 엔드포인트를 `/health`로 변경
   - status, version, timestamp를 반환하는 health check 구현
   
2. `feat: Add CORS middleware and health check frontend #2` (11:55)
   - CORS 미들웨어 추가 (localhost:5173 허용)
   - App.svelte에서 health check API 호출 및 조건부 렌더링 구현

## Key Decisions (주요 결정 사항)

### Health check 엔드포인트 구현
- **내용:** `/hello` 엔드포인트를 `/health`로 변경하고 status, version, timestamp 반환
- **이유:** 
  - 서비스 상태 모니터링을 위한 표준적인 health check 패턴 적용
  - 버전 정보와 타임스탬프를 함께 제공하여 배포 상태 확인 용이

### CORS 미들웨어 설정
- **내용:** `CORSMiddleware` 추가, localhost:5173(Vite 개발 서버) 허용
- **이유:** 
  - 프론트엔드(localhost:5173)와 백엔드(localhost:8000) 간 Cross-Origin 요청 허용
  - 개발 환경에서 API 통신 가능하도록 설정

### 전체 응답 객체를 변수에 저장
- **내용:** `health = json.status` 대신 `health = json`으로 전체 객체 저장
- **이유:** 
  - status뿐만 아니라 version, timestamp도 함께 표시하기 위해
  - API 응답의 모든 데이터를 활용하여 완전한 health check 정보 제공

### 조건부 렌더링 패턴 적용
- **내용:** `{#if health}` 블록으로 컴포넌트를 감싸고, 로딩 중 상태 표시
- **이유:** 
  - 비동기 데이터가 로드되기 전 `undefined.status` 접근으로 인한 런타임 에러 방지
  - 사용자에게 로딩 중임을 알리는 UX 개선

## Blockers & Solutions (블로커 & 해결책)

### 문제 1: CORS 정책 위반
- **원인:** 프론트엔드(localhost:5173)에서 백엔드(localhost:8000) API 호출 시 브라우저의 동일 출처 정책(Same-Origin Policy) 제한
- **해결:** 
  - FastAPI에 `CORSMiddleware` 추가
  - `allow_origins`에 프론트엔드 주소(`http://localhost:5173`) 명시

### 문제 2: TypeError - Cannot read properties of undefined
- **오류 내용:** `Uncaught TypeError: Cannot read properties of undefined (reading 'status')`
- **원인:** Svelte 컴포넌트가 마운트되어 첫 렌더링 시 `health`는 `undefined` 상태인데, 템플릿에서 `{health.status}` 접근 시도
- **해결:** 
  - `{#if health}` 조건부 렌더링 추가
  - health 객체가 로드된 후에만 속성에 접근하도록 수정

## TIL (느낀 점)
- **FastAPI 미들웨어 개념:**
  - CORS는 브라우저 보안 정책이며, 서버에서 명시적으로 허용해야 함
- **비동기 데이터 처리의 핵심 개념 이해:**
  - 컴포넌트 마운트 → 초기 렌더링 → fetch 시작 → 응답 도착 → 재렌더링 순서
  - 비동기 작업이 완료되기 전까지는 변수가 `undefined` 상태임을 명확히 이해
- **프론트엔드-백엔드 통신 구조:**
  - 로컬 개발 환경에서도 포트가 다르면 CORS 설정 필요
  - API 엔드포인트를 RESTful 규칙에 따라 명명하는 습관 (health check 패턴)

## Action Items (다음 할 일)
- [ ] PR 리뷰 및 Merge
- [ ] Docker & Docker Compose 구성 #5
- [ ] 다음 학습 단계로 진행 (책 내용 따라가기)
