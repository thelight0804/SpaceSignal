# 2025-12-18-데이터베이스, 인프라, CI/CD 기술 스택 선정 및 개발 환경 설정

## Summary (회의 요약)
SpaceSignal 프로젝트의 데이터베이스, 인프라, CI/CD 기술 스택을 결정하고 ADR 004, 005, 006을 작성함. AWS 관리형 서비스인 Amazon RDS for PostgreSQL을 선정하고, IaC 도구로 Terraform을 채택하되 "GUI 선행 학습 후 코드화" 전략을 수립함. Terraform 상태 관리를 로컬 tfstate로 시작하여 S3 백엔드로 단계적 전환하는 현실적인 학습 로드맵을 확정함. CI/CD 도구로 GitHub Actions를 선정하고, Rolling Restart 기반 배포 전략부터 시작하여 단계적으로 Blue-Green 배포까지 성숙시키는 로드맵을 수립함. GitHub Copilot이 프로젝트 맥락을 이해할 수 있도록 `.github/copilot-instructions.md` 파일을 생성하여 개발 효율성을 향상시킴.

## Key Decisions (주요 결정 사항)

### Amazon RDS for PostgreSQL 선정
- **내용:** EC2 직접 설치 대신 AWS 관리형 데이터베이스 서비스인 Amazon RDS for PostgreSQL 14+를 사용하기로 결정함.
- **이유:** 
  - 포트폴리오 목적: AWS 관리형 서비스 + Terraform IaC 경험을 동시에 어필 가능
  - 운영 자동화: 백업/패치/모니터링을 AWS가 자동 처리하여 개발에 집중
  - Walking Skeleton 전략에 부합: 인프라 설정 시간 최소화
  - Free Tier 활용: db.t3.micro 인스턴스 (20GB, 750시간/월, 12개월 무료)
  - 확장성: 트래픽 증가 시 쉬운 스펙 업그레이드

### 대안 기술 검토 및 기각
- **EC2 직접 설치:** 비용 절감은 되나 AWS 서비스 경험 어필 불가, 운영 부담 증가
- **Amazon Aurora:** 고성능이나 비용 과다 (월 $50+)
- **DynamoDB:** 관계형 데이터 모델링에 부적합, SQL 쿼리 불가

### GitHub Copilot Instructions 파일 생성
- **내용:** `.github/copilot-instructions.md` 파일을 생성하여 프로젝트 맥락, 기술 스택, 코드 스타일, 아키텍처 원칙을 정의함.
- **이유:**
  - 새로운 채팅 세션마다 AI가 프로젝트 맥락을 자동으로 이해하도록 함
  - 일관된 코드 스타일과 아키텍처 패턴 제안 유도
  - README와 ADR 문서의 핵심 내용을 통합하여 AI가 참조할 수 있도록 함
  - Python/FastAPI 및 Svelte 코드 작성 가이드라인 제공

### Terraform을 IaC 도구로 선정 (ADR 005)
- **내용:** 인프라 관리 도구로 Terraform을 채택하고, "GUI 선행 학습 후 코드화" 전략을 수립함.
- **이유:**
  - 재현성: 인프라를 코드로 관리하여 언제든 동일한 환경 재생성 가능
  - 버전 관리: Git으로 인프라 변경 이력 추적 및 롤백 가능
  - 학습 효율: AWS 콘솔에서 먼저 리소스를 생성해보고, 이를 Terraform으로 코드화하며 IaC 개념 학습
  - 멀티 클라우드 확장 가능: AWS 외에도 GCP, Azure 등 다양한 프로바이더 지원
- **대안 검토:**
  - CloudFormation: AWS 네이티브지만 JSON/YAML 문법이 복잡하고 AWS에만 종속
  - Pulumi: 익숙한 언어 사용 가능하나 커뮤니티 자료 부족
  - 수동 관리(GUI): 빠른 프로토타입용이나 재현성과 협업 측면에서 불리

### Terraform 상태 관리 - 단계적 접근 전략
- **내용:** Phase 1에서는 로컬 `terraform.tfstate` 파일로 시작하고, Phase 2+ CI/CD 구축 시점에 S3 백엔드로 마이그레이션하기로 결정함.
- **이유:**
  - 학습 곡선 완화: Terraform 문법 + AWS 리소스 학습에 집중하고, 백엔드 설정은 나중에
  - 1인 프로젝트: 현재는 협업이 없으므로 S3 백엔드의 핵심 이점(동시성 제어, 상태 공유)이 불필요
  - 마이그레이션 경험: 로컬 → S3 전환 과정 자체가 좋은 학습 경험
  - 트러블슈팅 용이: 초기에 tfstate 관련 이슈 발생 시 로컬 파일이 디버깅하기 더 쉬움
- **마이그레이션 방법:** `terraform init -migrate-state` 명령 사용

### GitHub Actions를 CI/CD 도구로 선정 (ADR 006)
- **내용:** CI/CD 도구로 GitHub Actions를 채택하고, Docker 기반 Rolling Restart 배포 전략을 수립함.
- **이유:**
  - 통합성: 이미 GitHub에서 코드 관리 중이므로 별도 서비스 연동 불필요
  - 실무 연결성: 실무에서 널리 사용되는 도구로 학습 내용을 실무에 바로 적용 가능
  - 무료 제공: Public Repository에서는 GitHub-hosted runner 무료 사용
  - Pipeline as Code: YAML 기반 설정으로 버전 관리 및 재현성 확보
- **CI 파이프라인:**
  - Backend: ruff/mypy (린트/타입 체크) + pytest (테스트)
  - Frontend: eslint/tsc (린트/타입 체크) + vitest (테스트)
- **CD 배포 전략 (단계적 성숙화):**
  - **Phase 1 (현재):** Rolling Restart - `docker compose up -d`로 단일 EC2 컨테이너 재시작
  - **Phase 2:** 자동 배포 + Environment secrets (Production/Staging 분리)
  - **Phase 3:** Blue-Green 배포 (Nginx/Traefik 리버스 프록시 도입), OIDC/SSM 기반 보안 강화
- **대안 검토:**
  - GitLab CI: 기능 강력하나 GitHub 기반 프로젝트에 비효율적
  - Jenkins: 자체 서버 운영 필요, 초기 설정 복잡
  - AWS CodePipeline: AWS 네이티브지만 GitHub Actions보다 유연성 낮고 비용 발생

### ADR 006 피드백 반영 및 개선
- **용어 정확성 개선:**
  - "Blue-Green 방식" → "Rolling Restart"로 수정 (현재 배포 방식과 일치)
  - Phase 3에 진정한 Blue-Green 배포 전략 추가 (Nginx/Traefik 기반 무중단 배포)
- **보안 및 운영 강화:**
  - Environment secrets 도입 (Production/Staging 환경 분리)
  - 최소 권한 원칙 명시 (deploy-user 전용 SSH 키)
  - Phase 3에 OIDC/SSM 기반 SSH 키 관리 개선 계획 추가
- **배포 워크플로우 개선:**
  - `workflow_dispatch` 추가 (Phase 1 수동 배포 트리거)
  - `concurrency` 설정 추가 (동시 배포 방지)
  - GHCR 로그인 단계 추가 (`docker/login-action`)
  - Docker 이미지 태그에 Git SHA 추가 (버전 추적)
  - Docker Compose v2 기준 명시 (`docker compose`)

## Blockers & Solutions (블로커 & 해결책)
해당 없음 (순조롭게 진행됨)

## TIL (느낀 점)
- 단순히 기능 구현뿐만 아니라 **AWS 서비스 경험**도 중요한 포인트임을 재확인함.
- GitHub Copilot의 `.github/copilot-instructions.md` 파일이 프로젝트별 맥락 제공에 매우 유용함을 확인함.
- Walking Skeleton의 핵심: "기능을 다 정해놓고 만드는 것"이 아니라, **"가장 핵심적인 뼈대 하나만 만들어서 끝까지(배포까지) 뚫어보는 것"**.
- 프로젝트 초기에 명확한 가이드라인(코드 스타일, 아키텍처 원칙)을 문서화하면 일관성 있는 개발이 가능함을 학습함.
- **상태 관리 단계화의 중요성**: 초보자가 처음부터 S3 백엔드 + DynamoDB 락을 설정하면 오히려 학습 곡선이 가파르고, 로컬 tfstate로 시작하여 점진적으로 전환하는 것이 현실적임을 확인함.
- 1인 프로젝트에서는 "학습 단계별 접근"이 우선이며, 필요한 시점에 마이그레이션하는 것이 효율적임을 체득함.
- **CI/CD 도구 선정**: GitHub Actions는 실무에서 널리 사용되므로, 학습한 내용이 바로 실무 경험으로 이어질 수 있음을 확인함.

## Action Items (다음 할 일)
- [ ] Git 브랜치 전략 수립 및 적용 (develop, feature/* 브랜치 생성 및 워크플로우 확정)
- [ ] 로컬 프로젝트 구조 생성 (backend/, frontend/, docs/ 등 디렉토리 구조 확정)
- [ ] 기존 문서 업데이트 (README.md, .github/copilot-instructions.md에 새로운 ADR 내용 반영)
- [ ] Backend Hello World 구현 (FastAPI 기본 서버 및 `/health` 엔드포인트)
- [ ] Frontend Hello World 구현 (Svelte 기본 페이지 및 API 호출 테스트)
- [ ] Backend Dockerfile 작성 (Python 3.13 기반 이미지)
- [ ] Frontend Dockerfile 작성 (Node.js 기반 빌드 + Nginx 서빙)
- [ ] docker-compose.yml 작성 및 로컬 실행 테스트 (`docker compose up`)
