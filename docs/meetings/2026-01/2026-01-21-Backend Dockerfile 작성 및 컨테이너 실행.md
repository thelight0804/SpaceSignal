# 2026-01-21-Backend Dockerfile 작성 및 컨테이너 실행

## Summary (회의 요약)
Backend Dockerfile 작성을 완료하고, Docker 이미지 빌드 및 컨테이너 실행에 성공함. Dockerfile 각 명령어의 역할과 Docker의 핵심 개념(레이어 캐싱, 네트워크 바인딩 등)을 학습하며 단계별로 직접 작성함.

## Key Decisions (주요 결정 사항)

### 베이스 이미지: python:3.13.11-slim 선택
- **내용:** `python:3.13.11-slim` 사용 (alpine 대신)
- **이유:** 
  - 로컬 Python 버전(3.13.11)과 정확히 일치
  - 용량 효율적 (~150MB vs 풀 이미지 1GB)

### 레이어 캐싱 최적화 적용
- **내용:** 
  1. `COPY requirements.txt .` 먼저
  2. `RUN pip install` 실행
  3. `COPY . .` 나중에
- **이유:** 
  - 소스 코드(main.py)는 자주 변경됨
  - requirements.txt는 거의 변경 안 됨
  - 의존성 설치 레이어를 캐시로 재사용 → 빌드 시간 단축

### .dockerignore 파일 생성
- **내용:** `__pycache__/`, `*.pyc` 등 제외
- **이유:** 
  - 불필요한 파일을 컨테이너에 복사하지 않음
  - 이미지 크기 감소, 빌드 속도 향상

### CMD 작성
- **내용:** `CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]`
- **이유:** 
  - 127.0.0.1: 컨테이너 내부에서만 접근 가능 (loopback)
  - 0.0.0.0: 모든 네트워크 인터페이스에서 요청 수락 (외부 접근 가능)
  - Docker 공식 권장 방식
  - 각 요소를 쉼표로 구분하여 명확하게 분리

### 컨테이너 네이밍: 환경 명시 방식 채택
- **내용:** 
  - 이미지: `spacesignal-backend`
  - 컨테이너: `spacesignal-backend-dev`
- **이유:** 
  - 개발/프로덕션 환경 구분 명확
  - 나중에 `spacesignal-backend-prod` 추가 가능
  - 이미지명과 컨테이너명 구분으로 혼동 방지

## Blockers & Solutions (블로커 & 해결책)

### 문제 1: 파일 추가 시 Dockerfile 수정 필요 여부
- **질문:** 파일이 추가될 때마다 COPY 문을 하나씩 추가해야 하나?
- **해결:** `COPY . .` 패턴 사용하여 모든 파일 복사 (단, .dockerignore로 제외 파일 관리)

### 문제 2: 127.0.0.1 vs 0.0.0.0 차이 이해
- **혼동:** 포트 매핑으로 오해
- **해결:** 
  - 바인딩 주소: 서버가 어떤 네트워크 인터페이스에서 리스닝할지 결정
  - 포트 매핑(-p): Docker가 호스트-컨테이너 간 포트 연결
  - 두 개념이 함께 작동해야 외부 접근 가능

## TIL (느낀 점)

### Dockerfile 명령어의 역할 이해
- **FROM**: 베이스 이미지 선택
- **WORKDIR**: 작업 디렉토리 설정
- **COPY**: 호스트 파일을 컨테이너로 복사
- **RUN**: 빌드 시점 명령 실행
- **EXPOSE**: 포트 정보 문서화
- **CMD**: 컨테이너 시작 시 실행 명령

### RUN vs CMD 차이
- **RUN**: 이미지 빌드 시 1번 실행, 결과가 레이어에 저장 (패키지 설치)
- **CMD**: 컨테이너 실행 시마다 실행, 저장 안 됨 (애플리케이션 시작)

### Docker의 레이어드 아키텍처
- 각 명령어가 새로운 레이어 생성
- 변경된 레이어부터만 다시 빌드
- 빌드 실패 시 성공한 레이어는 캐시에서 재사용
- 자주 변경되는 파일을 나중에 복사하면 빌드 효율성 향상

### 네트워크와 포트의 이해
- **바인딩 주소 (--host):**
  - 127.0.0.1: 집 안 인터폰 (내부만)
  - 0.0.0.0: 집 대문 초인종 (외부 접근 가능)
- **포트 매핑 (-p):**
  - `-p 8000:8000`: 호스트 8000 → 컨테이너 8000 연결
  - 둘 다 있어야 브라우저에서 localhost:8000 접속 가능

### 직접 Dockerfile을 작성하면서
- Docker를 공부할 때는 각 명령어가 낯설었지만, 단계별로 이해하니 구조를 명확히 알게 되었음!
- 직접 빌드하고 실행해서 브라우저에 띄우니 신기하고 뿌듯했다! ✌️

## Action Items (다음 할 일)
- [ ] Frontend Dockerfile 작성
- [ ] docker-compose.yml 작성 (Backend + Frontend 통합)
- [ ] 전체 시스템 Docker 환경 테스트
- [ ] GitHub Issue #5 완료 및 PR 생성